<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Think and Grow Rich: Interactive Workshop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #F8F7F4; /* Softer off-white */
        }
        h1, h2, h3, h4, .font-serif {
            font-family: 'Lora', serif;
        }
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .content-section.active {
            display: block;
        }
        .sidebar-link.active {
            background-color: #D6A354;
            color: #ffffff;
            font-weight: 600;
        }
        .sidebar-link.locked {
            color: #a8a29e;
            cursor: not-allowed;
            background-color: #f5f5f4;
        }
        .modal-backdrop {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 40;
            animation: fadeIn 0.3s;
        }
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
            animation: fadeIn 0.3s;
        }
        #login-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background-color: #F8F7F4;
            z-index: 100;
        }
        .prose strong { color: #A855F7; }
        .prose blockquote { 
            border-left-color: #D6A354; 
            background-color: #FDFBF7;
            padding: 1rem;
            font-style: italic;
        }
        .task-item.completed span {
            text-decoration: line-through;
            color: #9ca3af;
        }
        .principle-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .principle-card.locked {
            filter: grayscale(80%);
            opacity: 0.6;
            cursor: not-allowed;
        }
        .principle-card .completion-check {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #16a34a;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: scale(0.5);
            transition: opacity 0.3s, transform 0.3s;
        }
         .principle-card.completed .completion-check {
            opacity: 1;
            transform: scale(1);
        }
        .nav-link.active {
            background-color: #D6A354;
            color: white;
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800">
    <div id="login-overlay" class="flex items-center justify-center p-4">
        <div class="text-center bg-white p-8 sm:p-12 rounded-lg shadow-2xl max-w-md w-full">
            <h2 class="text-3xl font-bold text-stone-800 mb-4">Welcome to Your Workshop</h2>
            <p class="text-lg text-stone-600 mb-8">Sign in with Google to save your progress and build your legacy.</p>
            <button id="google-login-btn" class="inline-flex items-center justify-center w-full px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition-colors">
                <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48px" height="48px"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.089,5.571l6.19,5.238C44.572,36.833,48,31.145,48,24C48,22.659,47.862,21.35,47.611,20.083z"></path></svg>
                Sign in with Google
            </button>
        </div>
    </div>
    
    <div id="app" class="min-h-screen flex flex-col">
        <header class="bg-white/80 backdrop-blur-sm shadow-sm sticky top-0 z-30">
            <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-stone-700">Think & Grow Rich</h1>
                    </div>
                    <div class="hidden md:block">
                        <div id="main-nav" class="ml-10 flex items-baseline space-x-1">
                            <!-- Nav links will be injected here -->
                        </div>
                    </div>
                     <div id="user-area" class="flex items-center gap-4">
                         <div id="status-indicator" class="text-sm text-gray-500 opacity-0">Connecting...</div>
                         <button id="sign-out-btn" class="hidden nav-button bg-stone-200 hover:bg-stone-300 text-stone-800 font-bold py-2 px-4 rounded-lg transition duration-300">Sign Out</button>
                     </div>
                    <div class="md:hidden">
                        <button id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-stone-600 hover:text-stone-800 hover:bg-stone-200 focus:outline-none">
                            <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </nav>
            <div id="mobile-menu" class="md:hidden hidden">
                <div id="mobile-nav" class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <!-- Mobile nav links will be injected here -->
                </div>
            </div>
        </header>

        <main class="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">
            <div id="home" class="content-section">
                 <div class="text-center bg-white p-8 rounded-lg shadow-lg">
                    <h2 class="text-4xl font-bold text-stone-800 mb-4">"Whatever the Mind Can Conceive and Believe, It Can Achieve."</h2>
                    <p class="text-lg text-stone-600 max-w-3xl mx-auto mb-6">Welcome to the interactive workshop for Napoleon Hill's timeless classic, *Think and Grow Rich*. This is not just a book to be read; it's a philosophy to be lived. This digital experience is designed to help you move beyond passive reading into active practice. Here, you will find tools and exercises to help you define your desires, build unshakeable faith, and create actionable plans to transform your dreams into reality.</p>
                </div>
            </div>

            <div id="dashboard" class="content-section">
                 <div class="flex justify-between items-start mb-8">
                     <h2 id="dashboard-greeting" class="text-3xl font-bold text-stone-800">My Dashboard</h2>
                     <div id="dashboard-progress-summary" class="text-right"></div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 space-y-8">
                         <div class="bg-gradient-to-r from-purple-600 to-blue-500 text-white p-8 rounded-lg shadow-lg" id="next-step-card">
                            <!-- Next Step Content here -->
                        </div>
                        <div class="bg-white p-8 rounded-lg shadow-lg">
                            <h3 class="font-bold text-2xl mb-4 text-purple-600">My Definite Chief Aim</h3>
                            <div id="dashboard-desire" class="text-stone-700 prose lg:prose-lg max-w-none"></div>
                        </div>
                        <div class="bg-white p-8 rounded-lg shadow-lg">
                             <h3 class="font-bold text-2xl mb-4 text-purple-600">My Action Plan</h3>
                             <div id="dashboard-plan"></div>
                        </div>
                    </div>
                    <div class="bg-white p-8 rounded-lg shadow-lg">
                        <h3 class="font-bold text-2xl mb-4 text-purple-600">My Progress</h3>
                        <div class="chart-container" style="height: 250px; max-height: 250px;"><canvas id="progressChart"></canvas></div>
                        <div id="dashboard-faith" class="mt-8 text-stone-700 prose max-w-none"></div>
                    </div>
                </div>
            </div>

            <div id="principles-hub" class="content-section">
                <div class="text-center mb-12">
                     <h2 class="text-3xl font-bold text-stone-800">The 13 Principles of Achievement</h2>
                     <p class="mt-4 text-lg text-stone-600 max-w-3xl mx-auto">This is the core of Napoleon Hill's philosophy. Each principle is a step toward mastering your mind and directing it towards the attainment of your goals. Explore each principle to understand its meaning and engage with the interactive exercises to apply it to your own life. Click on a card to begin.</p>
                </div>
                <div id="principles-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                </div>
            </div>
            
            <div id="principles-detail-view" class="content-section">
                <div class="flex flex-col lg:flex-row gap-8">
                    <aside class="w-full lg:w-1/4 xl:w-1/5">
                        <h3 class="text-xl font-bold mb-4">The 13 Principles</h3>
                        <nav id="principles-sidebar" class="space-y-2">
                        </nav>
                    </aside>
                    <div id="principle-content-area" class="w-full lg:w-3/4 xl:w-4/5 bg-white p-6 sm:p-8 rounded-lg shadow-lg">
                    </div>
                </div>
            </div>
            
            <div id="workshop" class="content-section">
                <div class="text-center mb-12">
                     <h2 class="text-3xl font-bold text-stone-800">The Mindset Gymnasium</h2>
                     <p class="mt-4 text-lg text-stone-600 max-w-3xl mx-auto">Success is an inside job. Fortify your mind against the internal enemies of failure with these mental workouts.</p>
                </div>
                <div id="workshop-tools" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Workshop tools will be injected here -->
                </div>
            </div>
        </main>
    </div>

    <div id="desire-modal-backdrop" class="modal-backdrop"></div>
    <div id="desire-modal" class="modal bg-white rounded-lg shadow-2xl p-8 max-w-lg w-full">
        <!-- Desire Form Modal -->
        <h3 class="text-2xl font-bold mb-4">The Six Steps to Riches</h3>
        <p class="text-sm text-stone-600 mb-6">Follow this formula to transmute your desire for riches into its financial equivalent. Be specific and be bold.</p>
        <form id="desire-form">
            <div class="mb-4">
                <label for="desire-amount" class="block text-sm font-medium text-stone-700">1. The exact amount of money I desire is:</label>
                <input type="text" id="desire-amount" class="mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-amber-400 focus:ring focus:ring-amber-300 focus:ring-opacity-50" placeholder="$1,000,000">
            </div>
            <div class="mb-4">
                <label for="desire-give" class="block text-sm font-medium text-stone-700">2. What I intend to give in return:</label>
                <textarea id="desire-give" rows="3" class="mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-amber-400 focus:ring focus:ring-amber-300 focus:ring-opacity-50" placeholder="My full effort in building the most innovative marketing agency..."></textarea>
            </div>
            <div class="mb-4">
                <label for="desire-date" class="block text-sm font-medium text-stone-700">3. A definite date for its acquisition:</label>
                <input type="date" id="desire-date" class="mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-amber-400 focus:ring focus:ring-amber-300 focus:ring-opacity-50">
            </div>
            <div class="mb-4">
                <label for="desire-plan" class="block text-sm font-medium text-stone-700">4. My clear, definite plan to achieve it:</label>
                <textarea id="desire-plan" rows="4" class="mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-amber-400 focus:ring focus:ring-amber-300 focus:ring-opacity-50" placeholder="First, I will... Second, I will..."></textarea>
            </div>
            <div class="flex justify-end gap-4 mt-6">
                <button type="button" id="close-desire-modal" class="px-4 py-2 bg-stone-200 text-stone-800 rounded-lg hover:bg-stone-300">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-amber-500 text-white font-bold rounded-lg hover:bg-amber-600">Save Statement</button>
            </div>
        </form>
    </div>
    
    <div id="notification-modal" class="modal bg-white rounded-lg shadow-2xl p-8 max-w-md w-full text-center">
        <div id="notification-content"></div>
        <button id="close-notification-btn" class="mt-6 px-6 py-2 bg-amber-500 text-white font-bold rounded-lg hover:bg-amber-600">OK</button>
    </div>


    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Main App Logic
        document.addEventListener('DOMContentLoaded', function() {
            // Firebase and App State
            let db, auth, userId, userData;
            let isAuthReady = false;
            let progressChartInstance = null;

            const appData = {
                 principles: [
                    { id: 'desire', name: 'Desire', tagline: 'The Turning Point of All Achievement' },
                    { id: 'faith', name: 'Faith', tagline: 'Visualizing and Believing in Attainment' },
                    { id: 'auto-suggestion', name: 'Auto-Suggestion', tagline: 'Influencing the Subconscious Mind' },
                    { id: 'specialized-knowledge', name: 'Specialized Knowledge', tagline: 'Personal Experiences or Observations' },
                    { id: 'imagination', name: 'Imagination', tagline: 'The Workshop of the Mind' },
                    { id: 'organized-planning', name: 'Organized Planning', tagline: 'Crystallization of Desire into Action' },
                    { id: 'decision', name: 'Decision', tagline: 'The Mastery of Procrastination' },
                    { id: 'persistence', name: 'Persistence', tagline: 'The Sustained Effort to Induce Faith' },
                    { id: 'master-mind', name: 'Power of the Master Mind', tagline: 'The Driving Force' },
                    { id: 'sex-transmutation', name: 'Sex Transmutation', tagline: 'The Mystery of Converting Energy' },
                    { id: 'subconscious-mind', name: 'The Subconscious Mind', tagline: 'The Connecting Link' },
                    { id: 'brain', name: 'The Brain', tagline: 'A Broadcasting and Receiving Station' },
                    { id: 'sixth-sense', name: 'The Sixth Sense', tagline: 'The Door to the Temple of Wisdom' }
                ],
                content: [
                    {
                        id: 'desire',
                        title: 'Desire: The Turning Point of All Achievement',
                        summary: `Every great achievement starts with a burning, definite desire, not a mere wish or a hope. It is an all-consuming obsession. The story of Edwin C. Barnes, who "thought" his way into a partnership with Thomas Edison, perfectly illustrates this. He arrived at Edison's lab a penniless "tramp," but in his mind, he was already Edison's partner. He didn't say "I will work for Edison," he said "I will work *with* Edison." His burning desire was the one asset he possessed, and it was enough. To harness this principle, you must transform your vague wants into a clear, definite purpose and back it with persistence until it becomes a reality. <blockquote>"The starting point of all achievement is DESIRE. Keep this constantly in mind. Weak desires bring weak results, just as a small amount of fire makes a small amount of heat."</blockquote>`,
                        practice: {
                            title: "Practice: The Six-Step Formula",
                            description: "Napoleon Hill provides a practical, six-step method for transmuting desire into its financial equivalent. This is not a magic trick; it's a psychological tool to crystallize your goal and burn it into your subconscious mind. Click the button below to begin this foundational exercise.",
                            buttonText: "Define My Desire",
                            action: 'openDesireModal'
                        }
                    },
                    {
                        id: 'faith',
                        title: 'Faith: Visualizing and Believing in Attainment',
                        summary: `Faith is a state of mind that you can cultivate through auto-suggestion. It is the "head chemist" of the mind, which, when blended with thought, connects you with Infinite Intelligence. Faith is the basis of all "miracles" and mysteries that cannot be analyzed by the rules of science. It's the vital element that gives power and life to your desire. You must act as if you already possess what you desire, and your subconscious mind will hand over a practical plan for acquiring it. The story of U.S. Steel's formation illustrates this. Charles M. Schwab's idea was not just a clever plan; it was infused with such powerful faith that it magnetized J.P. Morgan and created a billion-dollar corporation from an intangible thought. <blockquote>"FAITH is the eternal elixir which gives life, power, and action to the impulse of thought!"</blockquote>`,
                        practice: {
                            title: "Practice: The Self-Confidence Formula",
                            description: "Your action for this principle is to read and absorb the Self-Confidence Formula daily. Internalize its meaning. The words themselves have power when mixed with belief.",
                            form: `
                                <div class="p-6 bg-stone-100 rounded-lg prose prose-stone max-w-none">
                                    <p><strong>First.</strong> I know that I have the ability to achieve the object of my Definite Purpose in life, therefore, I DEMAND of myself persistent, continuous action toward its attainment, and I here and now promise to render such action.</p>
                                    <p><strong>Second.</strong> I realize the dominating thoughts of my mind will eventually reproduce themselves in outward, physical action, and gradually transform themselves into physical reality, therefore, I will concentrate my thoughts for thirty minutes daily, upon the task of thinking of the person I intend to become, thereby creating in my mind a clear mental picture of that person.</p>
                                    <p><strong>Third.</strong> I know through the principle of auto-suggestion, any desire that I persistently hold in my mind will eventually seek expression through some practical means of attaining the object back of it, therefore, I will devote ten minutes daily to demanding of myself the development of SELF-CONFIDENCE.</p>
                                    <p><strong>Fourth.</strong> I have clearly written down a description of my DEFINITE CHIEF AIM in life, and I will never stop trying, until I shall have developed sufficient self-confidence for its attainment.</p>
                                    <p><strong>Fifth.</strong> I fully realize that no wealth or position can long endure, unless built upon truth and justice, therefore, I will engage in no transaction which does not benefit all whom it affects. I will succeed by attracting to myself the forces I wish to use, and the cooperation of other people. I will induce others to serve me, because of my willingness to serve others. I will eliminate hatred, envy, jealousy, selfishness, and cynicism, by developing love for all humanity, because I know that a negative attitude toward others can never bring me success. I will cause others to believe in me, because I will believe in them, and in myself.</p>
                                </div>
                                <div class="mt-6">
                                    <h4 class="font-bold text-lg mb-2">Affirmations on Faith</h4>
                                    <ul class="list-disc list-inside space-y-2 text-stone-600">
                                        <li>Faith is the only known antidote for FAILURE!</li>
                                        <li>Faith is the starting point of all accumulation of riches!</li>
                                        <li>Faith is the basis of all 'miracles,' and all mysteries which cannot be analyzed by the rules of science!</li>
                                        <li>Remember, faith is the 'head chemist' of the mind.</li>
                                    </ul>
                                </div>
                                <button class="action-button mt-6 w-full px-6 py-3 bg-amber-500 text-white font-bold rounded-lg hover:bg-amber-600 transition-transform transform hover:scale-105" data-action="saveFaith">I Commit to Reading This Daily</button>
                            `
                        }
                    },
                    // ... other principles (shortened for brevity)
                ]
            };

            const mainContentArea = document.getElementById('app');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const statusIndicator = document.getElementById('status-indicator');
            const loginOverlay = document.getElementById('login-overlay');
            const googleLoginBtn = document.getElementById('google-login-btn');


            // --- Firebase Setup ---
            async function setupFirebase() {
                try {
                    const firebaseConfig = {
                        apiKey: "AIzaSyCMeBuLbXz3W23IbfwWU8e-yS7Km8Akeao",
                        authDomain: "think-and-grow-rich-dba8e.firebaseapp.com",
                        projectId: "think-and-grow-rich-dba8e",
                        storageBucket: "think-and-grow-rich-dba8e.appspot.com",
                        messagingSenderId: "164639324890",
                        appId: "1:164639324890:web:e5a281464fd372771f43e3"
                    };
                    
                    const app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);
                    
                    onAuthStateChanged(auth, async (user) => {
                        if (user) {
                            userId = user.uid;
                            isAuthReady = true;
                            document.getElementById('sign-out-btn').classList.remove('hidden');
                            loginOverlay.style.display = 'none';
                            showStatus(`Hi, ${user.displayName.split(' ')[0]}`, false);
                            await loadUserData(userId);
                            setupLoggedInNav();
                            navigate('dashboard');
                        } else {
                            isAuthReady = false;
                            userId = null;
                            userData = null;
                            document.getElementById('sign-out-btn').classList.add('hidden');
                            loginOverlay.style.display = 'flex';
                            showStatus("Not Connected", true);
                            setupLoggedOutNav();
                            navigate('home');
                        }
                    });

                } catch (error) {
                    console.error("Firebase Initialization Error:", error);
                    showStatus("Connection Failed", true);
                }
            }
            
            async function handleSignOut() {
                try {
                    await signOut(auth);
                } catch (error) {
                    console.error("Sign Out Error", error);
                }
            }


            async function handleGoogleLogin() {
                const provider = new GoogleAuthProvider();
                try {
                    await signInWithPopup(auth, provider);
                } catch (error) {
                    console.error("Google Sign-In Error:", error);
                    showStatus("Login Failed", true);
                }
            }

            function showStatus(message, isError) {
                statusIndicator.textContent = message;
                statusIndicator.style.opacity = '1';
                statusIndicator.style.color = isError ? '#ef4444' : '#22c55e';
                if (!isError) {
                    setTimeout(() => {
                        statusIndicator.style.opacity = '0';
                    }, 3000);
                }
            }
            
            async function loadUserData(uid) {
                if (!db || !uid) return;
                
                const appId = "think-and-grow-rich-workshop";
                const docRef = doc(db, `artifacts/${appId}/users/${uid}/blueprint`, "data");
                
                try {
                    const docSnap = await getDoc(docRef);
                    if (docSnap.exists()) {
                        userData = docSnap.data();
                    } else {
                        userData = {
                            desireData: null,
                            faithFormula: '',
                            completedPrinciples: [],
                        };
                    }
                    renderDashboard();
                } catch (error) {
                    console.error("Error loading user data:", error);
                    showStatus("Load Failed", true);
                }
            }
            
             async function saveUserData(dataToSave) {
                if (!isAuthReady || !db || !userId) {
                    showNotification("Not connected to the database. Please sign in and try again.");
                    return;
                }
                showStatus("Saving...", false);
                const appId = "think-and-grow-rich-workshop";
                const docRef = doc(db, `artifacts/${appId}/users/${userId}/blueprint`, "data");
                try {
                    Object.assign(userData, dataToSave);
                    await setDoc(docRef, userData, { merge: true });
                    showStatus("Saved!", false);
                } catch (error) {
                    console.error("Error saving data: ", error);
                    showStatus("Save Failed", true);
                }
            }

            // --- UI and Navigation ---
            function setupLoggedInNav() {
                const navLinks = `
                    <a href="#" class="nav-link nav-button px-3 py-2 rounded-md text-sm font-medium" data-target="dashboard">Dashboard</a>
                    <a href="#" class="nav-link nav-button px-3 py-2 rounded-md text-sm font-medium" data-target="principles-hub">The 13 Principles</a>
                `;
                document.getElementById('main-nav').innerHTML = navLinks;
                document.getElementById('mobile-nav').innerHTML = navLinks.replace(/class="/g, 'class="block ');
            }
            
            function setupLoggedOutNav() {
                 const navLinks = `
                    <a href="#" class="nav-link nav-button px-3 py-2 rounded-md text-sm font-medium" data-target="home">Home</a>
                    <a href="#" class="nav-link nav-button px-3 py-2 rounded-md text-sm font-medium" data-target="principles-hub">The 13 Principles</a>
                `;
                 document.getElementById('main-nav').innerHTML = navLinks;
                 document.getElementById('mobile-nav').innerHTML = navLinks.replace(/class="/g, 'class="block ');
            }

            function navigate(targetId) {
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                });
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    targetSection.classList.add('active');
                }

                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                 document.querySelector(`.nav-link[data-target="${targetId}"]`)?.classList.add('active');

                if (targetId.startsWith('principles-') && targetId !== 'principles-hub') {
                    document.getElementById('principles-detail-view').classList.add('active');
                    const principleId = targetId.replace('principles-', '');
                    renderPrincipleDetail(principleId);
                } else if (targetId === 'principles-hub') {
                    renderPrincipleGrid();
                } else if (targetId === 'dashboard') {
                    renderDashboard();
                }
                
                window.scrollTo(0, 0);
                mobileMenu.classList.add('hidden');
            }
            
            function renderDashboard() {
                if (!userData) return;
                const desireDiv = document.getElementById('dashboard-desire');
                const faithDiv = document.getElementById('dashboard-faith');
                const planDiv = document.getElementById('dashboard-plan');
                const nextStepCard = document.getElementById('next-step-card');
                const greeting = document.getElementById('dashboard-greeting');
                const progressSummary = document.getElementById('dashboard-progress-summary');
                const progressChartCanvas = document.getElementById('progressChart');
                
                if(greeting) greeting.innerHTML = `Welcome, ${auth.currentUser.displayName.split(' ')[0]}`;

                if (userData.desireData) {
                    const { date, amount, give, plan } = userData.desireData;
                    desireDiv.innerHTML = `
                        <p class="mb-4">By the date of <strong>${new Date(date).toDateString()}</strong>, I will have in my possession <strong>${amount}</strong>, which will come to me in various amounts from time to time during the interim.</p>
                        <p class="mb-4">In return for this money I will give the most efficient service of which I am capable, rendering the fullest possible quantity, and the best possible quality of service in the form of: <strong>${give}</strong>.</p>
                        <p>My plan is as follows: <strong>${plan}</strong></p>
                    `;
                } else {
                    desireDiv.innerHTML = '<p class="italic">Define your Definite Chief Aim in the "Desire" module.</p>';
                }
                if(faithDiv) faithDiv.innerHTML = userData.faithFormula ? `<strong>My Self-Confidence Formula:</strong><div class="mt-2 text-sm">${userData.faithFormula.replace(/\n/g, '<br>')}</div>` : '<p class="italic">Create your Self-Confidence Formula in the "Faith" module.</p>';
                
                const completedCount = userData.completedPrinciples?.length || 0;
                const totalPrinciples = appData.principles.length;

                if(nextStepCard) {
                    if (completedCount >= totalPrinciples) {
                        nextStepCard.innerHTML = `<h3 class="font-bold text-2xl mb-2">Congratulations!</h3><p>You have mastered all 13 principles. Revisit them any time to reinforce your knowledge and continue to grow.</p>`;
                    } else {
                        const nextPrinciple = appData.principles[completedCount];
                        nextStepCard.innerHTML = `
                            <h3 class="font-bold text-2xl mb-2">Your Next Step</h3>
                            <p class="mb-4">Principle #${completedCount + 1}: <strong>${nextPrinciple.name}</strong> - ${nextPrinciple.tagline}</p>
                            <button class="nav-button bg-white text-purple-600 font-bold py-2 px-4 rounded-lg transition" data-target="principles-${nextPrinciple.id}">Begin Now</button>
                        `;
                    }
                }
                
                if(progressSummary) progressSummary.innerHTML = `<p class="text-xl font-bold">${completedCount} <span class="text-base font-normal text-stone-600">/ ${totalPrinciples} Principles Mastered</span></p>`;

                if(progressChartCanvas) {
                    const ctx = progressChartCanvas.getContext('2d');
                    if(progressChartInstance) progressChartInstance.destroy();
                    progressChartInstance = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Completed', 'Remaining'],
                            datasets: [{
                                data: [completedCount, totalPrinciples - completedCount],
                                backgroundColor: ['#9333ea', '#e5e7eb'],
                                borderColor: '#ffffff',
                                borderWidth: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            cutout: '70%',
                            plugins: {
                                legend: { display: false },
                                tooltip: { enabled: false }
                            }
                        }
                    });
                }
            }
            
            function renderPrincipleGrid() {
                const principlesGrid = document.getElementById('principles-grid');
                principlesGrid.innerHTML = '';
                const completedCount = userData?.completedPrinciples?.length || 0;
                 appData.principles.forEach((p, index) => {
                    const isCompleted = userData?.completedPrinciples?.includes(p.id);
                    const isLocked = index > completedCount;
                    const gridCard = `
                        <div class="nav-button principle-card bg-white p-6 rounded-lg shadow-lg ${isLocked ? 'locked' : 'hover:shadow-xl hover:-translate-y-1'} ${isCompleted ? 'completed' : ''}" data-target="${isLocked ? '' : 'principles-' + p.id}">
                            <div class="completion-check"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg></div>
                            <div class="flex items-center mb-2">
                                <span class="text-amber-500 font-bold text-2xl mr-3">${index + 1}</span>
                                <h4 class="text-xl font-bold text-stone-800">${p.name}</h4>
                            </div>
                            <p class="text-stone-600">${p.tagline}</p>
                        </div>
                    `;
                    principlesGrid.innerHTML += gridCard;
                });
            }

            function renderPrincipleDetail(principleId) {
                const contentArea = document.getElementById('principle-content-area');
                const principleData = appData.content.find(p => p.id === principleId);

                if (!principleData) {
                    contentArea.innerHTML = `<h2 class="text-2xl font-bold">Content not found for ID: ${principleId}</h2>`;
                    return;
                }

                practiceHtml = `
                    <div class="mt-8 pt-6 border-t border-stone-200">
                        <h3 class="text-xl font-bold text-amber-500 mb-2">${principleData.practice.title}</h3>
                        <p class="text-stone-600 mb-4">${principleData.practice.description}</p>
                        <div id="practice-content-area">${principleData.practice.form || ''}</div>
                    </div>
                `;

                contentArea.innerHTML = `
                    <div class="prose max-w-none text-stone-700">
                        <h2 class="text-3xl font-bold mb-4">${principleData.title}</h2>
                        ${principleData.summary.split('\n').map(p => `<p>${p}</p>`).join('')}
                    </div>
                    ${practiceHtml}
                `;
                
                const actionButton = contentArea.querySelector('.action-button');
                if(actionButton) {
                    actionButton.addEventListener('click', (e) => {
                        e.preventDefault();
                        const action = e.target.dataset.action;
                        if (action === 'saveFaith') handleFaithCommitment();
                    });
                }
            }
            
            async function handleFaithCommitment() {
                if (!userData.completedPrinciples.includes('faith')) {
                    userData.completedPrinciples.push('faith');
                }
                await saveUserData({ faithFormula: "User has committed to the Self-Confidence Formula.", completedPrinciples: userData.completedPrinciples });
                showNotification('Commitment saved! You are ready for the next principle.');
                navigate('dashboard');
            }
            
            function openDesireModal() {
                const modal = document.getElementById('desire-modal');
                const desireForm = modal.querySelector('#desire-form');
                if(desireForm) desireForm.reset();
                if (userData?.desireData) {
                    document.getElementById('desire-amount').value = userData.desireData.amount || '';
                    document.getElementById('desire-give').value = userData.desireData.give || '';
                    document.getElementById('desire-date').value = userData.desireData.date || '';
                    document.getElementById('desire-plan').value = userData.desireData.plan || '';
                }
                document.getElementById('desire-modal-backdrop').style.display = 'block';
                modal.style.display = 'block';
            }

            function closeDesireModal() {
               document.getElementById('desire-modal-backdrop').style.display = 'none';
               document.getElementById('desire-modal').style.display = 'none';
            }
            
            async function handleDesireFormSubmit(e) {
                e.preventDefault();
                const desireData = {
                    amount: document.getElementById('desire-amount').value,
                    give: document.getElementById('desire-give').value,
                    date: document.getElementById('desire-date').value,
                    plan: document.getElementById('desire-plan').value,
                };
                if (!desireData.amount || !desireData.give || !desireData.date || !desireData.plan) {
                    showNotification('Please fill out all fields to create your statement.');
                    return;
                }
                
                if (!userData.completedPrinciples.includes('desire')) {
                     userData.completedPrinciples.push('desire');
                }
                await saveUserData({ desireData: desireData, completedPrinciples: userData.completedPrinciples });
                renderDashboard();
                
                closeDesireModal();
                showNotification('Your Desire Statement has been saved!');
                navigate('dashboard');
            }
            
            function showNotification(message) {
                const modal = document.getElementById('notification-modal');
                const content = document.getElementById('notification-content');
                const backdrop = document.getElementById('desire-modal-backdrop');
                
                content.textContent = message;
                backdrop.style.display = 'block';
                modal.style.display = 'block';
            }

            function closeNotification() {
                document.getElementById('notification-modal').style.display = 'none';
                document.getElementById('desire-modal-backdrop').style.display = 'none';
            }
            
            
            // --- App Initialization ---
            function initStaticContent() {
                googleLoginBtn.addEventListener('click', handleGoogleLogin);
                document.getElementById('sign-out-btn').addEventListener('click', handleSignOut);
                document.getElementById('desire-form').addEventListener('submit', handleDesireFormSubmit);
                document.getElementById('close-desire-modal').addEventListener('click', closeDesireModal);
                document.getElementById('close-notification-btn').addEventListener('click', closeNotification);

                 mainContentArea.addEventListener('click', e => {
                    const navButton = e.target.closest('.nav-button');
                    const actionButton = e.target.closest('.action-button');
                    
                    if (navButton && navButton.dataset.target) {
                        e.preventDefault();
                         if (navButton.dataset.target) navigate(navButton.dataset.target);
                    }
                    
                    if (actionButton) {
                        e.preventDefault();
                        const action = actionButton.dataset.action;
                        if (action === 'openDesireModal') openDesireModal();
                        if (action === 'saveFaith') handleFaithCommitment();
                    }
                });
                
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });
            }
            
            // --- Run App ---
            initStaticContent();
            setupFirebase();

        });
    </script>
</body>
</html>
