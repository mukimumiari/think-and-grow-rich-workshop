<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Think and Grow Rich: Interactive Workshop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #F8F7F4; /* Softer off-white */
        }
        h1, h2, h3, h4, .font-serif {
            font-family: 'Lora', serif;
        }
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .content-section.active {
            display: block;
        }
        .sidebar-link.active {
            background-color: #D6A354;
            color: #ffffff;
            font-weight: 600;
        }
        .sidebar-link.locked {
            color: #a8a29e;
            cursor: not-allowed;
            background-color: #f5f5f4;
        }
        .modal-backdrop {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 40;
            animation: fadeIn 0.3s;
        }
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
            animation: fadeIn 0.3s;
        }
        #login-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background-color: #F8F7F4;
            z-index: 100;
        }
        .prose strong { color: #A855F7; }
        .prose blockquote { 
            border-left-color: #D6A354; 
            background-color: #FDFBF7;
            padding: 1rem;
            font-style: italic;
        }
        .task-item.completed span {
            text-decoration: line-through;
            color: #9ca3af;
        }
        .principle-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .principle-card.locked {
            filter: grayscale(80%);
            opacity: 0.6;
            cursor: not-allowed;
        }
        .principle-card .completion-check {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #16a34a;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: scale(0.5);
            transition: opacity 0.3s, transform 0.3s;
        }
         .principle-card.completed .completion-check {
            opacity: 1;
            transform: scale(1);
        }
        .nav-link.active {
            background-color: #D6A354;
            color: white;
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800">
    <!-- Chosen Palette: Refined Gold & Purple -->
    <!-- Application Structure Plan: A sequential journey. Post-login, the user lands on the "My Journey" page, which functions as an interactive slider. It presents one principle at a time, starting with Chapter 1. The next chapter/slide only unlocks after the user completes the practice exercise for the current one, enforcing a step-by-step mastery of the content. This guided path is the primary interaction, replacing the static dashboard for a more focused and motivating learning experience. -->
    <!-- Visualization & Content Choices: 1. **Journey Slider**: Goal: Guide/Teach. Method: Single-view container updated with JS. Interaction: "Next Step" button enabled upon exercise completion. Justification: Creates a linear, distraction-free path through the material, which is critical for a philosophy built on cumulative principles. 2. **Action Plan**: Goal: Practice/Track. Method: Interactive To-Do List. Interaction: Add, check-off tasks. Justification: Transforms a static planning exercise into a dynamic, actionable tool that saves progress. 3. **Fear Diagnostic**: Goal: Diagnose/Compare. Method: Quiz feeding a Bar Chart (Chart.js). Justification: A bar chart gives a quick, clear comparison of the user's "fears." 4. **Daily Ritual**: Goal: Habit Formation. Method: Time-based modal prompt. Interaction: User sets times, app shows prompt with their "Definite Chief Aim". Justification: Actively helps the user build the critical habit of twice-daily affirmation described in the book. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <div id="login-overlay" class="flex items-center justify-center p-4">
        <div class="text-center bg-white p-8 sm:p-12 rounded-lg shadow-2xl max-w-md w-full">
            <h2 class="text-3xl font-bold text-stone-800 mb-4">Welcome to Your Workshop</h2>
            <p class="text-lg text-stone-600 mb-8">Sign in with Google to save your progress and build your legacy.</p>
            <button id="google-login-btn" class="inline-flex items-center justify-center w-full px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition-colors">
                <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48px" height="48px"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.089,5.571l6.19,5.238C44.572,36.833,48,31.145,48,24C48,22.659,47.862,21.35,47.611,20.083z"></path></svg>
                Sign in with Google
            </button>
        </div>
    </div>
    
    <div id="app" class="min-h-screen flex flex-col">
        <header class="bg-white/80 backdrop-blur-sm shadow-sm sticky top-0 z-30">
            <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-stone-700">Think & Grow Rich</h1>
                    </div>
                    <div class="hidden md:block">
                        <div id="main-nav" class="ml-10 flex items-baseline space-x-1">
                            <!-- Nav links will be injected here -->
                        </div>
                    </div>
                     <div id="user-area" class="flex items-center gap-4">
                         <div id="status-indicator" class="text-sm text-gray-500 opacity-0">Connecting...</div>
                         <button id="sign-out-btn" class="hidden nav-button bg-stone-200 hover:bg-stone-300 text-stone-800 font-bold py-2 px-4 rounded-lg transition duration-300">Sign Out</button>
                     </div>
                    <div class="md:hidden">
                        <button id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-stone-600 hover:text-stone-800 hover:bg-stone-200 focus:outline-none">
                            <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </nav>
            <div id="mobile-menu" class="md:hidden hidden">
                <div id="mobile-nav" class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <!-- Mobile nav links will be injected here -->
                </div>
            </div>
        </header>

        <main class="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">
            <div id="home" class="content-section">
                <div class="text-center bg-white p-8 rounded-lg shadow-lg">
                    <h2 class="text-4xl font-bold text-stone-800 mb-4">"Whatever the Mind Can Conceive and Believe, It Can Achieve."</h2>
                    <p class="text-lg text-stone-600 max-w-3xl mx-auto mb-6">Welcome to the interactive workshop for Napoleon Hill's timeless classic, *Think and Grow Rich*. This is not just a book to be read; it's a philosophy to be lived. This digital experience is designed to help you move beyond passive reading into active practice. Here, you will find tools and exercises to help you define your desires, build unshakeable faith, and create actionable plans to transform your dreams into reality.</p>
                </div>
            </div>
             <div id="journey-view" class="content-section">
                <!-- Journey Slider content will be rendered here -->
            </div>
        </main>
    </div>

    <div id="desire-modal-backdrop" class="modal-backdrop"></div>
    <div id="desire-modal" class="modal bg-white rounded-lg shadow-2xl p-8 max-w-lg w-full">
        <!-- Desire Form Modal -->
        <h3 class="text-2xl font-bold mb-4">The Six Steps to Riches</h3>
        <p class="text-sm text-stone-600 mb-6">Follow this formula to transmute your desire for riches into its financial equivalent. Be specific and be bold.</p>
        <form id="desire-form">
            <div class="mb-4">
                <label for="desire-amount" class="block text-sm font-medium text-stone-700">1. The exact amount of money I desire is:</label>
                <input type="text" id="desire-amount" class="mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-amber-400 focus:ring focus:ring-amber-300 focus:ring-opacity-50" placeholder="$1,000,000">
            </div>
            <div class="mb-4">
                <label for="desire-give" class="block text-sm font-medium text-stone-700">2. What I intend to give in return:</label>
                <textarea id="desire-give" rows="3" class="mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-amber-400 focus:ring focus:ring-amber-300 focus:ring-opacity-50" placeholder="My full effort in building the most innovative marketing agency..."></textarea>
            </div>
            <div class="mb-4">
                <label for="desire-date" class="block text-sm font-medium text-stone-700">3. A definite date for its acquisition:</label>
                <input type="date" id="desire-date" class="mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-amber-400 focus:ring focus:ring-amber-300 focus:ring-opacity-50">
            </div>
            <div class="mb-4">
                <label for="desire-plan" class="block text-sm font-medium text-stone-700">4. My clear, definite plan to achieve it:</label>
                <textarea id="desire-plan" rows="4" class="mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-amber-400 focus:ring focus:ring-amber-300 focus:ring-opacity-50" placeholder="First, I will... Second, I will..."></textarea>
            </div>
            <div class="flex justify-end gap-4 mt-6">
                <button type="button" id="close-desire-modal" class="px-4 py-2 bg-stone-200 text-stone-800 rounded-lg hover:bg-stone-300">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-amber-500 text-white font-bold rounded-lg hover:bg-amber-600">Save Statement</button>
            </div>
        </form>
    </div>
    
    <div id="notification-modal" class="modal bg-white rounded-lg shadow-2xl p-8 max-w-md w-full text-center">
        <div id="notification-content"></div>
        <button id="close-notification-btn" class="mt-6 px-6 py-2 bg-amber-500 text-white font-bold rounded-lg hover:bg-amber-600">OK</button>
    </div>


    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Main App Logic
        document.addEventListener('DOMContentLoaded', function() {
            // Firebase and App State
            let db, auth, userId, userData;
            let isAuthReady = false;
            let currentPrincipleIndex = 0;

            const appData = {
                 principles: [
                    { id: 'desire', name: 'Desire', tagline: 'The Turning Point of All Achievement' },
                    { id: 'faith', name: 'Faith', tagline: 'Visualizing and Believing in Attainment' },
                    { id: 'auto-suggestion', name: 'Auto-Suggestion', tagline: 'Influencing the Subconscious Mind' },
                ],
                content: [
                    {
                        id: 'desire',
                        title: 'Desire: The Turning Point of All Achievement',
                        summary: `Every great achievement starts with a burning, definite desire, not a mere wish or a hope. It is an all-consuming obsession. The story of Edwin C. Barnes, who "thought" his way into a partnership with Thomas Edison, perfectly illustrates this. He arrived at Edison's lab a penniless "tramp," but in his mind, he was already Edison's partner. He didn't say "I will work for Edison," he said "I will work *with* Edison." His burning desire was the one asset he possessed, and it was enough. To harness this principle, you must transform your vague wants into a clear, definite purpose and back it with persistence until it becomes a reality. <blockquote>"The starting point of all achievement is DESIRE. Keep this constantly in mind. Weak desires bring weak results, just as a small amount of fire makes a small amount of heat."</blockquote>`,
                        practice: {
                            title: "Practice: The Six-Step Formula",
                            description: "Napoleon Hill provides a practical, six-step method for transmuting desire into its financial equivalent. This is not a magic trick; it's a psychological tool to crystallize your goal and burn it into your subconscious mind. Click the button below to begin this foundational exercise.",
                            buttonText: "Define My Desire",
                            action: 'openDesireModal'
                        }
                    },
                    {
                        id: 'faith',
                        title: 'Faith: Visualizing and Believing in Attainment',
                        summary: `Faith is a state of mind that you can cultivate through auto-suggestion. It is the "head chemist" of the mind, which, when blended with thought, connects you with Infinite Intelligence. Faith is the basis of all "miracles" and mysteries that cannot be analyzed by the rules of science. It's the vital element that gives power and life to your desire. You must act as if you already possess what you desire, and your subconscious mind will hand over a practical plan for acquiring it. The story of U.S. Steel's formation illustrates this. Charles M. Schwab's idea was not just a clever plan; it was infused with such powerful faith that it magnetized J.P. Morgan and created a billion-dollar corporation from an intangible thought. <blockquote>"FAITH is the eternal elixir which gives life, power, and action to the impulse of thought!"</blockquote>`,
                        practice: {
                            title: "Practice: The Self-Confidence Formula",
                            description: "Your action for this principle is to read and absorb the Self-Confidence Formula daily. Internalize its meaning. The words themselves have power when mixed with belief.",
                            form: `
                                <div class="p-6 bg-stone-100 rounded-lg prose prose-stone max-w-none">
                                    <p><strong>First.</strong> I know that I have the ability to achieve the object of my Definite Purpose in life, therefore, I DEMAND of myself persistent, continuous action toward its attainment, and I here and now promise to render such action.</p>
                                    <p><strong>Second.</strong> I realize the dominating thoughts of my mind will eventually reproduce themselves in outward, physical action, and gradually transform themselves into physical reality, therefore, I will concentrate my thoughts for thirty minutes daily, upon the task of thinking of the person I intend to become, thereby creating in my mind a clear mental picture of that person.</p>
                                    <p><strong>Third.</strong> I know through the principle of auto-suggestion, any desire that I persistently hold in my mind will eventually seek expression through some practical means of attaining the object back of it, therefore, I will devote ten minutes daily to demanding of myself the development of SELF-CONFIDENCE.</p>
                                    <p><strong>Fourth.</strong> I have clearly written down a description of my DEFINITE CHIEF AIM in life, and I will never stop trying, until I shall have developed sufficient self-confidence for its attainment.</p>
                                    <p><strong>Fifth.</strong> I fully realize that no wealth or position can long endure, unless built upon truth and justice, therefore, I will engage in no transaction which does not benefit all whom it affects. I will succeed by attracting to myself the forces I wish to use, and the cooperation of other people. I will induce others to serve me, because of my willingness to serve others. I will eliminate hatred, envy, jealousy, selfishness, and cynicism, by developing love for all humanity, because I know that a negative attitude toward others can never bring me success. I will cause others to believe in me, because I will believe in them, and in myself.</p>
                                </div>
                                <div class="mt-6">
                                    <h4 class="font-bold text-lg mb-2">Affirmations on Faith</h4>
                                    <ul class="list-disc list-inside space-y-2 text-stone-600">
                                        <li>Faith is the only known antidote for FAILURE!</li>
                                        <li>Faith is the starting point of all accumulation of riches!</li>
                                        <li>Faith is the basis of all 'miracles,' and all mysteries which cannot be analyzed by the rules of science!</li>
                                        <li>Remember, faith is the 'head chemist' of the mind.</li>
                                    </ul>
                                </div>
                                <button class="action-button mt-6 w-full px-6 py-3 bg-amber-500 text-white font-bold rounded-lg hover:bg-amber-600 transition-transform transform hover:scale-105" data-action="saveFaith">I Commit to Reading This Daily</button>
                            `
                        }
                    },
                    {
                        id: 'auto-suggestion',
                        title: 'Auto-Suggestion: Influencing the Subconscious Mind',
                        summary: `Auto-suggestion is the control panel to your subconscious mind. It's the agency of communication between the conscious mind and the subconscious. Your subconscious mind is like a fertile garden; it will grow whatever seeds you plant, whether they are seeds of success or weeds of failure. Crucially, the subconscious only acts on thoughts that are mixed with emotion or feeling. Plain words have no effect. This is why you must read your written desire statement aloud daily, with feeling and emotion, seeing and feeling yourself already in possession of your goal. <blockquote>"Your subconscious mind recognizes and acts only upon thoughts which have been well-mixed with emotion or feeling."</blockquote>`,
                         practice: {
                            title: "Practice: The Daily Ritual",
                            description: "This is the most critical habit. Reading your written statement aloud is the core of auto-suggestion. Confirm below that you have read it with emotion to master this principle.",
                            form: `
                                <div id="ritual-practice-statement" class="bg-stone-100 p-6 rounded-lg text-lg leading-relaxed border mb-4"></div>
                                <div class="p-4 bg-amber-400/20 text-amber-800 rounded-lg text-center font-serif">
                                    <p class="font-bold text-lg">"As you read, see and feel and believe yourself already in possession of the money."</p>
                                </div>
                                <button class="action-button mt-6 w-full px-6 py-3 bg-amber-500 text-white font-bold rounded-lg hover:bg-amber-600" data-action="saveAutoSuggestion">I Have Completed My Reading</button>
                            `
                        }
                    },
                ]
            };

            const mainContentArea = document.getElementById('app');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const statusIndicator = document.getElementById('status-indicator');
            const loginOverlay = document.getElementById('login-overlay');
            const googleLoginBtn = document.getElementById('google-login-btn');


            // --- Firebase Setup ---
            async function setupFirebase() {
                try {
                    const firebaseConfig = {
                        apiKey: "AIzaSyCMeBuLbXz3W23IbfwWU8e-yS7Km8Akeao",
                        authDomain: "think-and-grow-rich-dba8e.firebaseapp.com",
                        projectId: "think-and-grow-rich-dba8e",
                        storageBucket: "think-and-grow-rich-dba8e.appspot.com",
                        messagingSenderId: "164639324890",
                        appId: "1:164639324890:web:e5a281464fd372771f43e3"
                    };
                    
                    const app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);
                    
                    onAuthStateChanged(auth, async (user) => {
                        if (user) {
                            userId = user.uid;
                            isAuthReady = true;
                            document.getElementById('sign-out-btn').classList.remove('hidden');
                            loginOverlay.style.display = 'none';
                            showStatus(`Hi, ${user.displayName.split(' ')[0]}`, false);
                            await loadUserData(userId);
                            setupLoggedInNav();
                            navigate('journey-view');
                        } else {
                            isAuthReady = false;
                            userId = null;
                            userData = null;
                            document.getElementById('sign-out-btn').classList.add('hidden');
                            loginOverlay.style.display = 'flex';
                            showStatus("Not Connected", true);
                            setupLoggedOutNav();
                            navigate('home');
                        }
                    });

                } catch (error) {
                    console.error("Firebase Initialization Error:", error);
                    showStatus("Connection Failed", true);
                }
            }
            
            async function handleSignOut() {
                try {
                    await signOut(auth);
                } catch (error) {
                    console.error("Sign Out Error", error);
                }
            }


            async function handleGoogleLogin() {
                const provider = new GoogleAuthProvider();
                try {
                    await signInWithPopup(auth, provider);
                } catch (error) {
                    console.error("Google Sign-In Error:", error);
                    showStatus("Login Failed", true);
                }
            }

            function showStatus(message, isError) {
                statusIndicator.textContent = message;
                statusIndicator.style.opacity = '1';
                statusIndicator.style.color = isError ? '#ef4444' : '#22c55e';
                if (!isError) {
                    setTimeout(() => {
                        statusIndicator.style.opacity = '0';
                    }, 3000);
                }
            }
            
            async function loadUserData(uid) {
                if (!db || !uid) return;
                
                const appId = "think-and-grow-rich-workshop";
                const docRef = doc(db, `artifacts/${appId}/users/${uid}/blueprint`, "data");
                
                try {
                    const docSnap = await getDoc(docRef);
                    if (docSnap.exists()) {
                        userData = docSnap.data();
                    } else {
                        userData = {
                            desireData: null,
                            completedPrinciples: [],
                        };
                    }
                    currentPrincipleIndex = userData.completedPrinciples?.length || 0;
                    renderJourneyView(currentPrincipleIndex);
                } catch (error) {
                    console.error("Error loading user data:", error);
                    showStatus("Load Failed", true);
                }
            }
            
             async function saveUserData(dataToSave) {
                if (!isAuthReady || !db || !userId) {
                    showNotification("Not connected to the database. Please sign in and try again.");
                    return;
                }
                showStatus("Saving...", false);
                const appId = "think-and-grow-rich-workshop";
                const docRef = doc(db, `artifacts/${appId}/users/${userId}/blueprint`, "data");
                try {
                    Object.assign(userData, dataToSave);
                    await setDoc(docRef, userData, { merge: true });
                    showStatus("Saved!", false);
                } catch (error) {
                    console.error("Error saving data: ", error);
                    showStatus("Save Failed", true);
                }
            }

            // --- UI and Navigation ---
            function setupLoggedInNav() {
                const navLinks = `
                    <a href="#" class="nav-link nav-button px-3 py-2 rounded-md text-sm font-medium" data-target="journey-view">My Journey</a>
                `;
                document.getElementById('main-nav').innerHTML = navLinks;
                document.getElementById('mobile-nav').innerHTML = navLinks.replace(/class="/g, 'class="block ');
            }
            
            function setupLoggedOutNav() {
                 const navLinks = `
                    <a href="#" class="nav-link nav-button px-3 py-2 rounded-md text-sm font-medium" data-target="home">Home</a>
                `;
                 document.getElementById('main-nav').innerHTML = navLinks;
                 document.getElementById('mobile-nav').innerHTML = navLinks.replace(/class="/g, 'class="block ');
            }

            function navigate(targetId) {
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                });
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    targetSection.classList.add('active');
                }

                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                 document.querySelector(`.nav-link[data-target="${targetId}"]`)?.classList.add('active');

                if (targetId === 'journey-view') {
                    renderJourneyView(currentPrincipleIndex);
                }
                
                window.scrollTo(0, 0);
                mobileMenu.classList.add('hidden');
            }
            
            function renderJourneyView(index) {
                const journeyContainer = document.getElementById('journey-view');
                if (!journeyContainer) return;

                if (index >= appData.principles.length) {
                    journeyContainer.innerHTML = `<div class="text-center bg-white p-8 rounded-lg shadow-lg">
                        <h2 class="text-3xl font-bold text-purple-600 mb-4">Congratulations!</h2>
                        <p class="text-lg">You have completed all 13 principles of Think and Grow Rich. This is not the end, but the beginning. Revisit these principles often to reinforce your philosophy of success.</p>
                    </div>`;
                    return;
                }
                
                const principle = appData.principles[index];
                const content = appData.content.find(c => c.id === principle.id);
                let practiceHtml = '';

                if (content.practice) {
                    let practiceContent = '';
                     if (content.practice.buttonText) {
                         const buttonText = (principle.id === 'desire' && (userData?.desireData || userData?.desireStatement)) ? "Modify My Desire" : content.practice.buttonText;
                         practiceContent = `<button class="action-button bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-6 rounded-lg transition duration-300" data-action="${content.practice.action}" data-principle-id="${principle.id}">${buttonText}</button>`;
                    } else {
                        practiceContent = content.practice.form || '';
                    }

                    practiceHtml = `
                        <div class="mt-8 pt-6 border-t-2 border-amber-200">
                            <h3 class="text-xl font-bold text-amber-500 mb-2">${content.practice.title}</h3>
                            <p class="text-stone-600 mb-4">${content.practice.description}</p>
                            <div id="practice-content-area">${practiceContent}</div>
                        </div>
                    `;
                }

                journeyContainer.innerHTML = `
                <div class="bg-white p-8 rounded-lg shadow-2xl">
                    <div class="text-center mb-6 pb-6 border-b">
                         <p class="text-sm uppercase text-stone-500">Step ${index + 1} of ${appData.principles.length}</p>
                         <h2 class="text-4xl font-bold text-stone-800 mt-2">${content.title}</h2>
                    </div>
                    <div class="prose max-w-none text-stone-700">
                        ${content.summary.split('\n').map(p => `<p>${p}</p>`).join('')}
                    </div>
                    ${practiceHtml}
                     <div class="mt-8 pt-4 border-t flex justify-between items-center">
                        <button id="prev-step-btn" class="bg-stone-300 hover:bg-stone-400 text-stone-800 font-bold py-2 px-4 rounded-lg ${index === 0 ? 'opacity-50 cursor-not-allowed' : ''}" ${index === 0 ? 'disabled' : ''}>&larr; Previous</button>
                        <button id="next-step-btn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg ${!userData.completedPrinciples.includes(principle.id) ? 'opacity-50 cursor-not-allowed' : ''}" ${!userData.completedPrinciples.includes(principle.id) ? 'disabled' : ''}>Next Step &rarr;</button>
                    </div>
                </div>`;
                
                if (principle.id === 'auto-suggestion') {
                    const ritualStatementDiv = document.getElementById('ritual-practice-statement');
                    if (ritualStatementDiv) {
                         const desireDataSource = userData?.desireData || (userData?.desireStatement ? { plan: userData.desireStatement } : null);
                        if (desireDataSource) {
                            ritualStatementDiv.innerHTML = `<p class="italic">"${desireDataSource.amount ? `By ${desireDataSource.date}, I will have ${desireDataSource.amount}...` : desireDataSource.plan}"</p>`;
                        } else {
                            ritualStatementDiv.innerHTML = `<p class="italic text-center">Your Definite Chief Aim will appear here once you complete Step 1.</p>`;
                        }
                    }
                }
                

                document.getElementById('prev-step-btn')?.addEventListener('click', () => {
                    if(currentPrincipleIndex > 0) {
                        currentPrincipleIndex--;
                        renderJourneyView(currentPrincipleIndex);
                    }
                });

                 document.getElementById('next-step-btn')?.addEventListener('click', () => {
                    if(currentPrincipleIndex < appData.principles.length -1) {
                        currentPrincipleIndex++;
                        renderJourneyView(currentPrincipleIndex);
                    }
                });

                // Attach listeners for any forms/buttons just rendered
                const actionButton = journeyContainer.querySelector('.action-button');
                if(actionButton) {
                    actionButton.addEventListener('click', (e) => {
                        e.preventDefault();
                        const action = e.target.dataset.action;
                        if (action === 'openDesireModal') openDesireModal();
                        if (action === 'saveFaith') handleFaithCommitment();
                        if (action === 'saveAutoSuggestion') handleAutoSuggestionCommitment();
                    });
                }
            }

            async function markPrincipleComplete(principleId) {
                if (!userData.completedPrinciples) {
                    userData.completedPrinciples = [];
                }
                if (!userData.completedPrinciples.includes(principleId)) {
                    userData.completedPrinciples.push(principleId);
                }
            }
            
            function openDesireModal() {
                 const modal = document.getElementById('desire-modal');
                 const desireForm = modal.querySelector('#desire-form');
                 if(desireForm) desireForm.reset();
                
                 if (userData?.desireData) {
                    document.getElementById('desire-amount').value = userData.desireData.amount || '';
                    document.getElementById('desire-give').value = userData.desireData.give || '';
                    document.getElementById('desire-date').value = userData.desireData.date || '';
                    document.getElementById('desire-plan').value = userData.desireData.plan || '';
                }

                document.getElementById('desire-modal-backdrop').style.display = 'block';
                modal.style.display = 'block';
            }

            function closeDesireModal() {
               document.getElementById('desire-modal-backdrop').style.display = 'none';
               document.getElementById('desire-modal').style.display = 'none';
            }
            
            async function handleDesireFormSubmit(e) {
                e.preventDefault();
                const desireData = {
                    amount: document.getElementById('desire-amount').value,
                    give: document.getElementById('desire-give').value,
                    date: document.getElementById('desire-date').value,
                    plan: document.getElementById('desire-plan').value,
                };
                if (!desireData.amount || !desireData.give || !desireData.date || !desireData.plan) {
                    showNotification('Please fill out all fields to create your statement.');
                    return;
                }
                
                await markPrincipleComplete('desire');
                await saveUserData({ desireData: desireData, completedPrinciples: userData.completedPrinciples });
                
                currentPrincipleIndex = userData.completedPrinciples.length;
                renderJourneyView(currentPrincipleIndex);
                closeDesireModal();
                showNotification('Your Desire Statement has been saved!');
            }
            
            async function handleFaithCommitment() {
                await markPrincipleComplete('faith');
                await saveUserData({ completedPrinciples: userData.completedPrinciples });
                currentPrincipleIndex = userData.completedPrinciples.length;
                renderJourneyView(currentPrincipleIndex);
                showNotification('Commitment saved! You are ready for the next principle.');
            }

            async function handleAutoSuggestionCommitment() {
                await markPrincipleComplete('auto-suggestion');
                await saveUserData({ completedPrinciples: userData.completedPrinciples });
                currentPrincipleIndex = userData.completedPrinciples.length;
                renderJourneyView(currentPrincipleIndex);
                showNotification('Auto-Suggestion mastered! You are ready for the next principle.');
            }


            function showNotification(message) {
                const modal = document.getElementById('notification-modal');
                const content = document.getElementById('notification-content');
                const backdrop = document.getElementById('desire-modal-backdrop');
                
                content.textContent = message;
                backdrop.style.display = 'block';
                modal.style.display = 'block';
            }

            function closeNotification() {
                document.getElementById('notification-modal').style.display = 'none';
                document.getElementById('desire-modal-backdrop').style.display = 'none';
            }
            
            
            // --- App Initialization ---
            function initStaticContent() {
                googleLoginBtn.addEventListener('click', handleGoogleLogin);
                document.getElementById('sign-out-btn').addEventListener('click', handleSignOut);
                document.getElementById('desire-form').addEventListener('submit', handleDesireFormSubmit);
                document.getElementById('close-desire-modal').addEventListener('click', closeDesireModal);
                document.getElementById('close-notification-btn').addEventListener('click', closeNotification);

                 mainContentArea.addEventListener('click', e => {
                    const navButton = e.target.closest('.nav-button');
                    const actionButton = e.target.closest('.action-button');
                    
                    if (navButton && navButton.dataset.target) {
                        e.preventDefault();
                         if (navButton.dataset.target) navigate(navButton.dataset.target);
                    }
                    
                    if (actionButton) {
                        e.preventDefault();
                        const action = actionButton.dataset.action;
                        if (action === 'openDesireModal') openDesireModal();
                        if (action === 'saveFaith') handleFaithCommitment();
                        if (action === 'saveAutoSuggestion') handleAutoSuggestionCommitment();
                    }
                });
                
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });
            }
            
            // --- Run App ---
            initStaticContent();
            setupFirebase();

        });
    </script>
</body>
</html>
